# Subscription-Status-Viewer

## Architecture Overview

### Tech Stack

- **Frontend:** React 18 + TypeScript + MUI
- **Backend:** AWS Amplify Gen 2 Functions (Node.js 20)
- **Auth:** AWS Cognito
- **Payment:** Stripe API (Test Mode)
- **Database:** None (hardcoded user mapping per requirements)

### System Architecture

```
User Browser
    ↓
React App (Login → Dashboard → Subscription Page)
    ↓
AWS Cognito (Auth) + Amplify Functions
    ↓
Stripe API (Subscriptions + Billing Portal)
```

## Key Decisions

### 1. No Database

**Why:** Requirements specify "environment variable or hardcoded mapping"
**Implementation:**

```typescript
const CUSTOMER_MAP = {
  "user-id": process.env.STRIPE_TEST_CUSTOMER_ID,
};
```

### 2. Two Backend Functions

- `getSubscriptionStatus` - Fetch subscription from Stripe
- `createBillingPortal` - Generate Stripe portal URL

### 3. Security

- Stripe secret keys: server-side only
- Auth: Cognito JWT validation
- User can only access own data

## Project Structure

### Frontend Structure

```
src/
├── main.tsx                    # App entry point
├── App.tsx                     # Root component with routing
├── theme.ts                    # MUI theme configuration
│
├── pages/
│   ├── LoginPage.tsx          # Auth UI (Amplify Authenticator)
│   ├── DashboardPage.tsx      # Landing page after login
│   └── SubscriptionPage.tsx   # Main feature: show subscription
│
├── components/
│   ├── SubscriptionStatus.tsx # Display subscription info (MUI Card)
│   ├── LoadingSpinner.tsx     # MUI CircularProgress wrapper
│   └── ErrorMessage.tsx       # MUI Alert for errors
│
├── hooks/
│   ├── useSubscription.ts     # Fetch subscription data
│   └── useAuth.ts             # Amplify auth state
│
├── types/
│   └── subscription.ts        # TypeScript interfaces
│
└── utils/
    └── api.ts                 # Amplify function client calls
```

### Backend Structure

```
amplify/
├── backend.ts                              # Amplify backend config
│
├── auth/
│   └── resource.ts                         # Cognito user pool setup
│
├── functions/
│   ├── get-subscription-status/
│   │   ├── handler.ts                      # Lambda: get subscription
│   │   ├── resource.ts                     # Function definition
│   │   └── package.json                    # Stripe SDK dependency
│   │
│   └── create-billing-portal/
│       ├── handler.ts                      # Lambda: billing portal
│       ├── resource.ts                     # Function definition
│       └── package.json                    # Stripe SDK dependency
│
└── shared/
    ├── types.ts                            # Shared TypeScript types
    └── stripe-client.ts                    # Stripe client singleton
```

### Configuration Files

```
/
├── package.json                # Frontend dependencies (MUI, React, etc)
├── tsconfig.json              # TypeScript config
├── vite.config.ts             # Vite bundler config
├── .env.local                 # Local environment variables
└── amplify_outputs.json       # Auto-generated by Amplify CLI
```

## API Design

### GET Subscription Status

**Response:**

```typescript
{
  status: 'active' | 'trialing' | 'past_due' | 'canceled' | 'none',
  planName?: string,
  renewalDate?: string,
  renewalPeriod?: 'month' | 'year'
}
```

### Create Billing Portal

**Request:** `{ returnUrl: string }`
**Response:** `{ url: string }`

## Trade-offs

| Decision          | Why                      | Future                      |
| ----------------- | ------------------------ | --------------------------- |
| Hardcoded mapping | Fast, meets requirements | Add DynamoDB later          |
| No webhooks       | Time constraint          | Add as stretch goal         |
| Tailwind CSS      | Speed over polish        | Acceptable per requirements |

## What Would I Add With More Time

1. Webhook handler for real-time updates
2. DynamoDB for user→customer mapping
3. Amplitude event tracking
4. Unit tests
5. Billing history table
