# Subscription-Status-Viewer

## Architecture Overview

### Tech Stack

- **Frontend:** React 18 + TypeScript + MUI
- **Backend:** AWS Amplify Gen 2 Functions (Node.js 20)
- **Auth:** AWS Cognito
- **Payment:** Stripe API (Test Mode)
- **Database:** None (hardcoded user mapping per requirements)

### System Architecture

```
User Browser
    ↓
React App (Login → Dashboard → Subscription Page)
    ↓
AWS Cognito (Auth) + Amplify Functions
    ↓
Stripe API (Subscriptions + Billing Portal)
```

## Key Decisions

### 1. No Database

**Why:** Requirements specify "environment variable or hardcoded mapping"
**Implementation:**

```typescript
const CUSTOMER_MAP = {
  "user-id": process.env.STRIPE_TEST_CUSTOMER_ID,
};
```

### 2. Two Backend Functions

- `getSubscriptionStatus` - Fetch subscription from Stripe
- `createBillingPortal` - Generate Stripe portal URL

### 3. Security

- Stripe secret keys: server-side only
- Auth: Cognito JWT validation
- User can only access their own data

## Project Structure

### Frontend Structure


```
src/
├── main.tsx                           # Application entry point
├── App.tsx                            # Root component with routing setup
├── theme.ts                           # MUI theme configuration
├── vite-env.d.ts                      # Vite TypeScript declarations
│
├── pages/                             # Top-level route components
│   ├── LoginPage.tsx                 # Authentication UI (Amplify Authenticator)
│   ├── DashboardPage.tsx             # Post-login landing page
│   └── SubscriptionPage.tsx          # Main feature: subscription management
│
├── components/
│   ├── ui/                           # Reusable base UI components
│   │   ├── Button.tsx               # Styled button with consistent theming
│   │   ├── Card.tsx                 # Card container wrapper
│   │   ├── Table.tsx                # Table component with sorting/filtering
│   │   ├── LoadingSpinner.tsx       # Loading state indicator (MUI CircularProgress)
│   │   └── ErrorMessage.tsx         # Error alert display (MUI Alert)
│   │
│   └── features/                     # Business-specific components
│       └── SubscriptionStatus.tsx   # Subscription info card with plan details
│
├── hooks/                            # Custom React hooks
│   ├── useSubscription.ts           # Fetch and manage subscription data (React Query)
│   ├── useAuth.ts                   # Amplify authentication state
│   └── useBillingPortal.ts          # Create Stripe Billing Portal session
│
├── types/                            # TypeScript type definitions
│   ├── subscription.ts              # Subscription-related interfaces
│   └── api.ts                       # API request/response types
│
├── utils/                            # Utility functions
│   ├── api.ts                       # Amplify API client helpers
│   └── formatters.ts                # Date/currency formatting utilities
│
└── config/                           # Configuration files
    └── amplify.ts                    # Amplify configuration wrapper
```


### Backend Structure

```
amplify/
├── backend.ts                              # Amplify backend config
│
├── auth/
│   └── resource.ts                         # Cognito user pool setup
│
├── functions/
│   ├── get-subscription-status/
│   │   ├── handler.ts                      # Lambda: get subscription
│   │   ├── resource.ts                     # Function definition
│   │   └── package.json                    # Stripe SDK dependency
│   │
│   └── create-billing-portal/
│       ├── handler.ts                      # Lambda: billing portal
│       ├── resource.ts                     # Function definition
│       └── package.json                    # Stripe SDK dependency
│
└── shared/
    ├── types.ts                            # Shared TypeScript types
    └── stripe-client.ts                    # Stripe client singleton
```

### Configuration Files

```
/
├── package.json                # Frontend dependencies (MUI, React, etc)
├── tsconfig.json              # TypeScript config
├── vite.config.ts             # Vite bundler config
├── .env.local                 # Local environment variables
└── amplify_outputs.json       # Auto-generated by Amplify CLI
```

## API Design

### GET Subscription Status

**Response:**

```typescript
{
  status: 'active' | 'trialing' | 'past_due' | 'canceled' | 'none',
  planName?: string,
  renewalDate?: string,
  renewalPeriod?: 'month' | 'year'
}
```

### Create Billing Portal

**Request:** `{ returnUrl: string }`
**Response:** `{ url: string }`

## Trade-offs

| Decision          | Why                      | Future                      |
| ----------------- | ------------------------ | --------------------------- |
| Hardcoded mapping | Fast, meets requirements | Add DynamoDB later          |
| No webhooks       | Time constraint          | Add as stretch goal         |
| Tailwind CSS      | Speed over polish        | Acceptable per requirements |

## What Would I Add With More Time

1. Webhook handler for real-time updates
2. DynamoDB for user→customer mapping
3. Amplitude event tracking
4. Unit tests
5. Billing history table
